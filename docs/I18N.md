# Internationalization (i18n) Guide

This document describes how to work with the internationalization system in Krawlet.

## Overview

Krawlet uses a custom i18n system built with Svelte stores. It supports:

- Multiple languages (currently English and Spanish)
- Nested translation keys
- Parameter interpolation
- Automatic locale detection
- Persistent language preference

## Core Concepts

### The `locale` Store

The current language is stored in a Svelte store:

```typescript
import { locale, setLocale } from '$lib/i18n';

// Read current locale
const currentLang = $locale; // 'en' or 'es'

// Change language
setLocale('es');
```

### The `t()` Function

Translations are accessed using the `t()` function:

```typescript
import { t } from '$lib/i18n';

// Simple translation
const greeting = t('common.hello'); // "Hello"

// With parameters
const message = t('notifications.newTransaction', {
	from: 'Alice',
	amount: '100',
	to: 'Bob'
}); // "New transaction: Alice sent 100 KRO to Bob"
```

## Translation File Structure

Translation files are located in `src/lib/i18n/locales/`:

```
locales/
├── en.ts    # English (default)
└── es.ts    # Spanish
```

### File Format

Each translation file exports a default object with nested keys:

```typescript
// src/lib/i18n/locales/en.ts
export default {
	common: {
		loading: 'Loading...',
		error: 'Error',
		save: 'Save',
		cancel: 'Cancel'
		// ...
	},
	nav: {
		home: 'Home',
		addresses: 'Addresses'
		// ...
	},
	wallet: {
		balance: 'Balance',
		send: 'Send'
		// ...
	}
	// Additional sections...
} as const;
```

### Key Sections

| Section         | Purpose                           |
| --------------- | --------------------------------- |
| `common`        | Generic UI text (buttons, labels) |
| `nav`           | Navigation menu items             |
| `wallet`        | Wallet-related text               |
| `transaction`   | Transaction-related text          |
| `name`          | Name management text              |
| `shop`          | Shop-related text                 |
| `settings`      | Settings page text                |
| `notifications` | Toast notification messages       |
| `errors`        | Error messages                    |
| `accessibility` | Screen reader text                |
| `pwa`           | PWA-related text                  |
| `websocket`     | Connection status text            |
| `help`          | Help page content                 |
| `footer`        | Footer text                       |

## Using Translations in Components

### Basic Usage (Reactive)

For reactive translations that update when the language changes, use the `t$` store:

```svelte
<script lang="ts">
	import { t$ } from '$lib/i18n';
</script>

<h1>{$t$('common.loading')}</h1>
<button>{$t$('common.save')}</button>
```

### With Parameters

```svelte
<script lang="ts">
	import { t$ } from '$lib/i18n';

	const page = 1;
	const total = 10;
</script>

<span>{$t$('accessibility.pageNumber', { page, total })}</span>
<!-- Output: "Page 1 of 10" -->
```

### In Imperative Code

For non-reactive contexts (e.g., notification messages, event handlers), use the `t()` function:

```svelte
<script lang="ts">
	import { t } from '$lib/i18n';
	import { notifications } from '$lib/stores/notifications';

	function showSuccess() {
		notifications.success(t('notifications.success'));
	}
</script>
```

### Why Two Methods?

- **`$t$(...)`** - A Svelte store subscription. Use in templates for reactive UI that updates when language changes.
- **`t(...)`** - A plain function. Use in event handlers, callbacks, or any imperative code.

## Adding a New Language

1. Create a new file in `src/lib/i18n/locales/`:

```typescript
// src/lib/i18n/locales/fr.ts
export default {
	common: {
		loading: 'Chargement...',
		error: 'Erreur'
		// ... translate all keys
	}
	// ... all other sections
} as const;
```

2. Register the locale in `src/lib/i18n/index.ts`:

```typescript
import en from './locales/en';
import es from './locales/es';
import fr from './locales/fr'; // Add import

const translations: Record<string, typeof en> = {
	en,
	es,
	fr // Add to translations
};

export const availableLocales = ['en', 'es', 'fr']; // Add to list
```

3. Add the language option in settings:

```svelte
<!-- src/routes/settings/+page.svelte -->
const languageOptions = [
  { value: 'en', label: 'English' },
  { value: 'es', label: 'Español' },
  { value: 'fr', label: 'Français' }, // Add option
];
```

## Adding New Translation Keys

1. Add the key to the English file first:

```typescript
// src/lib/i18n/locales/en.ts
export default {
	mySection: {
		newKey: 'New translation text',
		keyWithParam: 'Hello, {name}!'
	}
	// ...
} as const;
```

2. Add the same key to all other language files:

```typescript
// src/lib/i18n/locales/es.ts
export default {
	mySection: {
		newKey: 'Nuevo texto de traducción',
		keyWithParam: '¡Hola, {name}!'
	}
	// ...
} as const;
```

3. Use the new key in components:

```svelte
<script lang="ts">
	import { t$ } from '$lib/i18n';
</script>

<p>{$t$('mySection.newKey')}</p><p>{$t$('mySection.keyWithParam', { name: 'Alice' })}</p>
```

## Best Practices

### Key Naming

- Use dot notation for hierarchy: `section.subsection.key`
- Use camelCase for key names
- Keep keys descriptive but concise
- Group related translations together

### Interpolation

- Use `{paramName}` for parameters
- Keep parameter names consistent across languages
- Document expected parameters in comments if complex

### Accessibility

- Include screen reader text in translations
- Use `accessibility.*` section for ARIA labels
- Test with different languages enabled

### Consistency

- Always add new keys to ALL language files
- Keep the same structure across all files
- Use TypeScript's `as const` for type safety

## Troubleshooting

### Missing Translation

If a key is missing, `t()` returns the key itself:

```typescript
t('nonexistent.key'); // Returns 'nonexistent.key'
```

### Type Errors

If you get TypeScript errors, ensure:

1. All language files have the same structure
2. The `as const` assertion is present
3. Import paths are correct

### Language Not Persisting

The language preference is saved in the settings store. Ensure:

1. Settings store is properly initialized
2. `setLocale()` is being called
3. Browser localStorage is available
